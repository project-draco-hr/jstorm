{
  final TopologyMetricsRunnable metricRunnable=data.getMetricRunnable();
  int threadNum=ConfigExtension.getNimbusMetricThreadNum(data.getConf());
  for (int i=0; i < threadNum; i++) {
    AsyncLoopThread thread=new AsyncLoopThread(metricRunnable);
    smartThreads.add(thread);
  }
  Runnable pusher=new Runnable(){
    @Override public void run(){
      TopologyMetricsRunnable.Upload event=new TopologyMetricsRunnable.Upload();
      event.timeStamp=System.currentTimeMillis();
      metricRunnable.pushEvent(event);
    }
  }
;
  ScheduledExecutorService scheduleService=data.getScheduExec();
  scheduleService.scheduleAtFixedRate(pusher,120,60,TimeUnit.SECONDS);
  SimpleJStormMetric nimbusMetric=SimpleJStormMetric.mkInstance();
  scheduleService.scheduleAtFixedRate(nimbusMetric,120,60,TimeUnit.SECONDS);
  LOG.info("Successfully init metrics uploading thread");
}
