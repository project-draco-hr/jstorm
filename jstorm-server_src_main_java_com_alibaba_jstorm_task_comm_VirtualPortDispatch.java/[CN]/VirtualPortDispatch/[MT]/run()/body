{
  boolean hasTuple=false;
  while (active.get() == true) {
    byte[] data=recvConn.recv(0);
    if (data == null || data.length == 0) {
      if (hasTuple == false) {
        JStormUtils.sleepMs(1);
      }
      continue;
    }
    hasTuple=true;
    long before=System.currentTimeMillis();
    int port=KryoTupleDeserializer.deserializeTaskId(data);
    if (port == -1) {
      active.set(false);
      break;
    }
    if (valid_ports == null || valid_ports.contains(port)) {
      IConnection sendConn=sendConns.get(port);
      if (sendConn == null) {
        sendConn=context.connect(topologyId,"localhost",port,false);
        sendConns.put(port,sendConn);
      }
      sendConn.send(port,data);
    }
 else {
      LOG.warn("Received invalid message directed at port " + port + ". Dropping...");
    }
    long after=System.currentTimeMillis();
    runCounter.count(after - before);
  }
  if (active.get() == false) {
    cleanup();
  }
}
