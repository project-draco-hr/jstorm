{
  LOG.info("Shutting down supervisor " + supervisorId);
  active.set(false);
  int size=threads.size();
  for (int i=0; i < size; i++) {
    SmartThread thread=threads.elementAt(i);
    thread.cleanup();
    JStormUtils.sleepMs(10);
    thread.interrupt();
    try {
      thread.join();
    }
 catch (    InterruptedException e) {
      LOG.error(e.getMessage(),e);
    }
  }
  eventManager.shutdown();
  processesEventManager.shutdown();
  try {
    stormClusterState.disconnect();
  }
 catch (  Exception e) {
    LOG.error("Failed to shutdown ZK client",e);
  }
  httpserver.shutdown();
  isFinishShutdown=true;
  JStormUtils.halt_process(0,"!!!Shutdown!!!");
}
