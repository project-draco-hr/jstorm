{
  if (active.get() == false) {
    return;
  }
  try {
synchronized (this) {
      Assignment assignment=zkCluster.assignment_info(topologyId,this);
      if (assignment == null) {
        String errMsg="Failed to get Assignment of " + topologyId;
        LOG.error(errMsg);
        return;
      }
      Set<ResourceWorkerSlot> workers=assignment.getWorkers();
      if (workers == null) {
        String errMsg="Failed to get taskToResource of " + topologyId;
        LOG.error(errMsg);
        return;
      }
      workerData.getWorkerToResource().addAll(workers);
      Map<Integer,WorkerSlot> my_assignment=new HashMap<Integer,WorkerSlot>();
      Map<String,String> node=assignment.getNodeHost();
      Set<WorkerSlot> need_connections=new HashSet<WorkerSlot>();
      Set<Integer> localNodeTasks=new HashSet<Integer>();
      if (workers != null && outboundTasks != null) {
        for (        ResourceWorkerSlot worker : workers) {
          if (supervisorId.equals(worker.getNodeId()))           localNodeTasks.addAll(worker.getTasks());
          for (          Integer id : worker.getTasks()) {
            if (outboundTasks.contains(id)) {
              my_assignment.put(id,worker);
              need_connections.add(worker);
            }
          }
        }
      }
      taskNodeport.putAll(my_assignment);
      workerData.setLocalNodeTasks(localNodeTasks);
      Set<WorkerSlot> current_connections=nodeportSocket.keySet();
      Set<WorkerSlot> new_connections=new HashSet<WorkerSlot>();
      Set<WorkerSlot> remove_connections=new HashSet<WorkerSlot>();
      for (      WorkerSlot node_port : need_connections) {
        if (!current_connections.contains(node_port)) {
          new_connections.add(node_port);
        }
      }
      for (      WorkerSlot node_port : current_connections) {
        if (!need_connections.contains(node_port)) {
          remove_connections.add(node_port);
        }
      }
      for (      WorkerSlot nodePort : new_connections) {
        String host=node.get(nodePort.getNodeId());
        int port=nodePort.getPort();
        IConnection conn=context.connect(topologyId,host,port);
        nodeportSocket.put(nodePort,conn);
        LOG.info("Add connection to " + nodePort);
      }
      for (      WorkerSlot node_port : remove_connections) {
        LOG.info("Remove connection to " + node_port);
        nodeportSocket.remove(node_port).close();
      }
    }
  }
 catch (  Exception e) {
    LOG.error("Failed to refresh worker Connection",e);
    throw new RuntimeException(e);
  }
}
