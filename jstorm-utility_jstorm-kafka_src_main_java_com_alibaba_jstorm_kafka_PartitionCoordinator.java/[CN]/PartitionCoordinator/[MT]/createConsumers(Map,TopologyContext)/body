{
  partitionConsumerMap=new HashMap<Partition,PartitionConsumer>();
  List<Partition> allPartitions=new ArrayList<Partition>();
  for (  Host broker : config.brokers) {
    for (int i=0; i < config.numPartitions; i++) {
      allPartitions.add(new Partition(broker,i));
    }
  }
  int taskSize=context.getComponentTasks(context.getThisComponentId()).size();
  for (int i=context.getThisTaskIndex(); i < allPartitions.size(); i+=taskSize) {
    Partition partition=allPartitions.get(i);
    MessageConsumer smc=createConsumer(partition);
    PartitionConsumer partitionConsumer=new PartitionConsumer(conf,smc,config,partition,zkState);
    partitionConsumer.setCoordinator(this);
    partitionConsumerMap.put(partition,partitionConsumer);
    partitionConsumers.add(partitionConsumer);
  }
}
