{
  Map<String,StateHeartbeat> workeridHbstate=new HashMap<String,StateHeartbeat>();
  int now=TimeUtils.current_time_secs();
  Map<String,WorkerHeartbeat> idToHeartbeat=readWorkerHeartbeats(conf);
  for (  Map.Entry<String,WorkerHeartbeat> entry : idToHeartbeat.entrySet()) {
    String workerid=entry.getKey().toString();
    WorkerHeartbeat whb=entry.getValue();
    State state=null;
    if (whb == null) {
      state=State.notStarted;
    }
 else     if (matchesAssignment(whb,assignedTasks) == false) {
      state=State.disallowed;
    }
 else     if ((now - whb.getTimeSecs()) > JStormUtils.parseInt(conf.get(Config.SUPERVISOR_WORKER_TIMEOUT_SECS))) {
      state=State.timedOut;
    }
 else {
      if (isWorkerDead(workerid)) {
        state=State.timedOut;
      }
 else {
        state=State.valid;
      }
    }
    if (state != State.valid) {
      LOG.info("Worker:" + workerid + " state:"+ state+ " WorkerHeartbeat: "+ whb+ " at supervisor time-secs "+ now);
    }
 else {
      LOG.debug("Worker:" + workerid + " state:"+ state+ " WorkerHeartbeat: "+ whb+ " at supervisor time-secs "+ now);
    }
    workeridHbstate.put(workerid,new StateHeartbeat(state,whb));
  }
  return workeridHbstate;
}
