{
  if (submittedJar == null) {
    NimbusClient client=NimbusClient.getConfiguredClient(conf);
    try {
      LOG.info("Jar not uploaded to master yet. Submitting jar...");
      String localJar=System.getProperty("storm.jar");
      path=client.getClient().beginFileUpload();
      String[] pathCache=path.split("/");
      String uploadLocation=path + "/stormjar-" + pathCache[pathCache.length - 1]+ ".jar";
      List<String> lib=(List<String>)conf.get(GenericOptionsParser.TOPOLOGY_LIB_NAME);
      Map<String,String> libPath=(Map<String,String>)conf.get(GenericOptionsParser.TOPOLOGY_LIB_PATH);
      if (lib != null && lib.size() != 0) {
        for (        String libName : lib) {
          String jarPath=path + "/" + libName;
          client.getClient().beginLibUpload(jarPath);
          submitJar(conf,libPath.get(libName),jarPath,client);
        }
        if (localJar != null)         submittedJar=submitJar(conf,localJar,uploadLocation,client);
      }
 else {
        submittedJar=submitJar(conf,localJar,uploadLocation,client);
      }
    }
 catch (    Exception e) {
      throw new RuntimeException(e);
    }
 finally {
      client.close();
    }
  }
 else {
    LOG.info("Jar already uploaded to master. Not submitting jar.");
  }
}
