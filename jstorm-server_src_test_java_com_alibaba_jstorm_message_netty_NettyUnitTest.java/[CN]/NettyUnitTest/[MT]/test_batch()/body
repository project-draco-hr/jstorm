{
  System.out.println("!!!!!!!!!!Start batch message test!!!!!!!!");
  IContext context=TransportFactory.makeContext(storm_conf);
  final IConnection server=context.bind(null,port);
  IConnection client=null;
  WaitStrategy waitStrategy=(WaitStrategy)Utils.newInstance((String)storm_conf.get(Config.TOPOLOGY_DISRUPTOR_WAIT_STRATEGY));
  DisruptorQueue recvQueue=new DisruptorQueue(new SingleThreadedClaimStrategy(1024),waitStrategy);
  server.registerQueue(recvQueue);
  client=context.connect(null,"localhost",port);
  final int base=100000;
  List<TaskMessage> list=new ArrayList<TaskMessage>();
  for (int i=1; i < Short.MAX_VALUE; i++) {
    String req_msg=String.valueOf(i + base);
    TaskMessage message=new TaskMessage(task,req_msg.getBytes());
    list.add(message);
  }
  client.send(list);
  System.out.println("Finish Send ");
  for (int i=1; i < Short.MAX_VALUE; i++) {
    TaskMessage message=server.recv(0);
    Assert.assertEquals(String.valueOf(i + base),new String(message.message()));
    if (i % 1000 == 0) {
      System.out.println("Receive " + i);
    }
  }
  System.out.println("Finish Receive ");
  client.close();
  server.close();
  context.term();
  System.out.println("!!!!!!!!!!End batch message test!!!!!!!!");
}
