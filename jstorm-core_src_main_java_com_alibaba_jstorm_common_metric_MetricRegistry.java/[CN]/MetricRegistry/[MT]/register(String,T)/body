{
  if (metric instanceof MetricSet) {
    registerAll(name,(MetricSet)metric);
  }
 else {
    final Metric existing=metrics.putIfAbsent(name,metric);
    if (existing == null) {
      LOG.info("Successfully register metric of {}",name);
    }
 else {
      throw new IllegalArgumentException("A metric named " + name + " already exists");
    }
  }
  return metric;
}
