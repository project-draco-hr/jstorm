{
  if (requests == null || requests.isEmpty() || being_closed.get())   return;
  Object last_msg=requests.get(requests.size() - 1);
  if (last_msg == ControlMessage.CLOSE_MESSAGE) {
    being_closed.set(true);
    requests.remove(last_msg);
  }
  if (requests.isEmpty()) {
    return;
  }
  ChannelFuture future=channel.write(requests);
  future.addListener(new ChannelFutureListener(){
    public void operationComplete(    ChannelFuture future) throws Exception {
      if (!future.isSuccess()) {
        LOG.warn("Failed to send requests:",future.getCause());
        future.getChannel().close();
      }
 else {
      }
    }
  }
);
}
