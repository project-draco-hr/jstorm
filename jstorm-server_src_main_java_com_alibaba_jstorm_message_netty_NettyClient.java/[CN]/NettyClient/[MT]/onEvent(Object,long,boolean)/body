{
  if (event == null) {
    endOfBatch=true;
  }
 else {
    msgCacheList.add(event);
  }
  if (!endOfBatch) {
    return;
  }
  MessageBatch batch=new MessageBatch(buffer_size);
  while (true) {
    Object _event=msgCacheList.poll();
    if (_event == null) {
      break;
    }
    if (_event == ControlMessage.CLOSE_MESSAGE) {
      batch.add(_event);
      break;
    }
    TaskMessage message=(TaskMessage)_event;
    batch.add(message);
    if (batch.isFull() == true) {
      readyBatchs.offer(batch);
      batch=new MessageBatch(buffer_size);
    }
  }
  if (batch.isEmpty() == false) {
    readyBatchs.offer(batch);
  }
}
