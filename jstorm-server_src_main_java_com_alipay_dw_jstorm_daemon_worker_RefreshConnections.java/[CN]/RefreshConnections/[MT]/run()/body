{
  if (active.get() == false) {
    return;
  }
  try {
    Assignment assignment=zkCluster.assignment_info(topologyId,this);
    if (assignment == null) {
      String errMsg="Failed to get Assignment of " + topologyId;
      LOG.error(errMsg);
      return;
    }
    Map<Integer,NodePort> my_assignment=new HashMap<Integer,NodePort>();
    Map<Integer,NodePort> taskNodeportAll=assignment.getTaskToNodeport();
    Map<String,String> node=assignment.getNodeHost();
    Set<NodePort> need_connections=new HashSet<NodePort>();
    if (taskNodeportAll != null && outboundTasks != null) {
      for (      Entry<Integer,NodePort> mm : taskNodeportAll.entrySet()) {
        int taks_id=mm.getKey();
        if (outboundTasks.contains(taks_id)) {
          my_assignment.put(taks_id,mm.getValue());
          need_connections.add(mm.getValue());
        }
      }
    }
    taskNodeport.putAll(my_assignment);
    Set<NodePort> current_connections=nodeportSocket.keySet();
    Set<NodePort> new_connections=new HashSet<NodePort>();
    Set<NodePort> remove_connections=new HashSet<NodePort>();
    for (    NodePort node_port : need_connections) {
      if (!current_connections.contains(node_port)) {
        new_connections.add(node_port);
      }
    }
    for (    NodePort node_port : current_connections) {
      if (!need_connections.contains(node_port)) {
        remove_connections.add(node_port);
      }
    }
    for (    NodePort nodePort : new_connections) {
      String host=node.get(nodePort.getNode());
      int port=nodePort.getPort();
      ISendConnection conn=mqContext.connect(true,host,port);
      nodeportSocket.put(nodePort,conn);
      LOG.info("Add connection to " + nodePort);
    }
    for (    NodePort node_port : remove_connections) {
      LOG.info("Remove connection to " + node_port);
      nodeportSocket.remove(node_port).close();
    }
  }
 catch (  Exception e) {
    LOG.error("Failed to refresh worker Connection",e);
  }
}
