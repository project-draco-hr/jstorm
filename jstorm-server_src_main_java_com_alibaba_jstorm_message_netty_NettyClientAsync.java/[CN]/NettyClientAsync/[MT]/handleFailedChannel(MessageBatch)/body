{
  messageBatchRef.set(messageBatch);
  flush_later.set(true);
  long cachedSize=messageBatch.getEncoded_length();
  if (cachedSize > BATCH_THREASHOLD_WARN) {
    long sleepMs=getDelaySec(cachedSize);
    if (blockSend == false) {
      LOG.warn("Target server  {} is unavailable, pending {}, bufferSize {}, block sending {}ms",name,pendings.get(),cachedSize,sleepMs);
      JStormUtils.sleepMs(sleepMs);
      reconnect();
    }
 else {
      waitChannelReady(cachedSize,sleepMs);
    }
  }
  return;
}
