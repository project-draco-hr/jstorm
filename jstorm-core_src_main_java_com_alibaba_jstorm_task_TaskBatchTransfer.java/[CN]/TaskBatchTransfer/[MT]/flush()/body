{
  Map<Integer,BatchTuple> oldBatchMap=null;
synchronized (lock) {
    oldBatchMap=batchMap;
    batchMap=new HashMap<Integer,BatchTuple>();
  }
  for (  Entry<Integer,BatchTuple> entry : oldBatchMap.entrySet()) {
    BatchTuple batch=entry.getValue();
    if (batch != null && batch.currBatchSize() > 0) {
      serializeQueue.publish(batch);
    }
  }
}
