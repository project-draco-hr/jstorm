{
  List<TopologyDetails> needsSchedulingTopologies=cluster.needsSchedulingTopologies(topologies);
  for (  TopologyDetails topology : needsSchedulingTopologies) {
    String topologyId=topology.getId();
    Map<ExecutorDetails,WorkerSlot> newAssignment=scheduleTopology(topology,cluster);
    Map<WorkerSlot,List<ExecutorDetails>> result=new HashMap<WorkerSlot,List<ExecutorDetails>>();
    for (    Entry<ExecutorDetails,WorkerSlot> entry : newAssignment.entrySet()) {
      List<ExecutorDetails> cache=result.get(entry.getValue());
      if (cache == null) {
        cache=new ArrayList<ExecutorDetails>();
        result.put(entry.getValue(),cache);
      }
      cache.add(entry.getKey());
    }
    for (    Entry<WorkerSlot,List<ExecutorDetails>> entry : result.entrySet()) {
      cluster.assign(entry.getKey(),topologyId,entry.getValue());
    }
  }
}
