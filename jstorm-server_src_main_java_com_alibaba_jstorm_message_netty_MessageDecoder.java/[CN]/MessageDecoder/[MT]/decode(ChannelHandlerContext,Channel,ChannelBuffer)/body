{
  long available=buf.readableBytes();
  if (available < 2) {
    return null;
  }
  timer.start();
  try {
    buf.markReaderIndex();
    short code=buf.readShort();
    ControlMessage ctrl_msg=ControlMessage.mkMessage(code);
    if (ctrl_msg != null) {
      return ctrl_msg;
    }
    short task=code;
    available-=2;
    if (available < 4) {
      buf.resetReaderIndex();
      return null;
    }
    int length=buf.readInt();
    if (length <= 0) {
      LOG.info("Receive one message whose TaskMessage's message length is {}",length);
      return new TaskMessage(task,null);
    }
    available-=4;
    if (available < length) {
      buf.resetReaderIndex();
      return null;
    }
    ChannelBuffer payload=buf.readBytes(length);
    byte[] rawBytes=payload.array();
    TaskMessage ret=new TaskMessage(task,rawBytes);
    return ret;
  }
  finally {
    timer.stop();
  }
}
