{
  if (buf.readableBytes() < 2) {
    LOG.debug("buf.readableBytes() < 2  {}",buf.readableBytes());
    return null;
  }
  buf.markReaderIndex();
  short code=buf.readShort();
  ControlMessage ctrl_msg=ControlMessage.mkMessage(code);
  if (ctrl_msg != null) {
    LOG.debug("Receive one ControlMessage message {}",ctrl_msg);
    return ctrl_msg;
  }
  short task=code;
  if (buf.readableBytes() < 4) {
    LOG.debug("buf.readableBytes() < 4 {} ",buf.readableBytes());
    buf.resetReaderIndex();
    return null;
  }
  int length=buf.readInt();
  if (length <= 0) {
    LOG.debug("TaskMessage's message length is {}",length);
    return null;
  }
  if (buf.readableBytes() < length) {
    LOG.debug("buf.readableBytes():{} is less TaskMessage.message().length:{}",buf.readableBytes(),length);
    buf.resetReaderIndex();
    return null;
  }
  ChannelBuffer payload=buf.readBytes(length);
  byte[] rawBytes=payload.array();
  TaskMessage ret=new TaskMessage(task,rawBytes);
  return ret;
}
