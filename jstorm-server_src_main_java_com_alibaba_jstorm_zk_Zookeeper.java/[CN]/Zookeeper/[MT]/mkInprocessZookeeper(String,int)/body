{
  LOG.info("Starting inprocess zookeeper at port " + port + " and dir "+ localdir);
  File localfile=new File(localdir);
  ZooKeeperServer zk=new ZooKeeperServer(localfile,localfile,2000);
  NIOServerCnxn.Factory factory=new NIOServerCnxn.Factory(new InetSocketAddress(port));
  factory.startup(zk);
  return factory;
}
