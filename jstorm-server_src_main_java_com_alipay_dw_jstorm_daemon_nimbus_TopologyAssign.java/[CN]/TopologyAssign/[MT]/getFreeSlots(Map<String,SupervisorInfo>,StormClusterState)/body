{
  Set<NodePort> rtn=new HashSet<NodePort>();
  Map<String,List<Integer>> allSlots=new HashMap<String,List<Integer>>();
  for (  Entry<String,SupervisorInfo> entry : supervisorInfos.entrySet()) {
    allSlots.put(entry.getKey(),entry.getValue().getWorkPorts());
  }
  Map<String,Set<Integer>> assignedSlots=Cluster.assignedSlots(stormClusterState);
  for (  Entry<String,List<Integer>> entry : allSlots.entrySet()) {
    String supervisorid=entry.getKey();
    List<Integer> s=entry.getValue();
    Set<Integer> e=assignedSlots.get(supervisorid);
    if (e != null) {
      s.removeAll(e);
    }
    for (Iterator<Integer> iter=s.iterator(); iter.hasNext(); ) {
      NodePort nodeport=new NodePort(supervisorid,iter.next());
      rtn.add(nodeport);
    }
  }
  return rtn;
}
