{
  Set<Integer> allTaskIds=JStormUtils.listToSet(stormClusterState.task_ids(topologyId));
  if (allTaskIds == null || allTaskIds.size() == 0) {
    String errMsg="Failed to get all task ID list from /ZK-dir/tasks/" + topologyId;
    LOG.warn(errMsg);
    throw new IOException(errMsg);
  }
  Set<NodePort> freeSlots=getFreeSlots(supInfos,stormClusterState);
  Map<NodePort,List<Integer>> aliveAssigned=getAliveAssigned(existingAssignment,stormClusterState,allTaskIds,topologyId,isScratch);
  Map<NodePort,List<Integer>> unstopped=getUnstoppedSlots(aliveAssigned,supInfos);
  return assignTasks(topologyId,existingAssignment,stormClusterState,supInfos,isScratch,allTaskIds,freeSlots,aliveAssigned,unstopped);
}
