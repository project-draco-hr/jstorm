{
  LOG.info("Begin to start nimbus with conf " + conf);
  try {
    StormConfig.validate_distributed_mode(conf);
    createPid(conf);
    initShutdownHook();
    inimbus.prepare(conf,StormConfig.masterInimbus(conf));
    data=createNimbusData(conf,inimbus);
    initFollowerThread(conf);
    int port=ConfigExtension.getNimbusDeamonHttpserverPort(conf);
    hs=new Httpserver(port);
    hs.start();
    initContainerHBThread(conf);
    if (ConfigExtension.isAlimonitorMetricsPost(conf))     initUploadMetricThread(data);
    while (!data.isLeader())     Utils.sleep(5000);
    init(conf);
  }
 catch (  Throwable e) {
    LOG.error("Fail to run nimbus ",e);
  }
 finally {
    cleanup();
  }
  LOG.info("Quit nimbus");
}
