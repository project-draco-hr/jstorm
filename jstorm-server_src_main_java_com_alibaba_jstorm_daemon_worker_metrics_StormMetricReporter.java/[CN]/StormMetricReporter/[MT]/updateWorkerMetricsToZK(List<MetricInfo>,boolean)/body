{
  StormClusterState clusterState=workerData.getZkCluster();
  String topologyId=workerData.getTopologyId();
  String hostName;
  hostName=NetWorkUtils.ip();
  String workerId=hostName + ":" + workerData.getPort();
  WorkerMetricInfo workerMetricInfo=new WorkerMetricInfo(hostName,workerData.getPort());
  try {
    for (    MetricInfo metricInfo : metricList) {
      if (metricPerf == false && ((metricInfo.getMetric() instanceof Timer) || (metricInfo.getMetric() instanceof Histogram)))       continue;
      workerMetricInfo.updateMetricData(metricInfo);
    }
    Runtime rt=Runtime.getRuntime();
    long usedMem=rt.totalMemory() - rt.freeMemory();
    workerMetricInfo.setUsedMem(usedMem);
    workerMetricInfo.setUsedCpu(getCpuUsage());
    clusterState.update_worker_metric(topologyId,workerId,workerMetricInfo);
  }
 catch (  Exception e) {
    logger.error(marker,"Failed to update metrics data in ZK for topo-{} idStr-{}.",topologyId,workerId,e);
  }
}
