{
  StormClusterState clusterState=workerData.getZkCluster();
  String topologyId=workerData.getTopologyId();
  for (  Entry<String,List<MetricInfo>> entry : metricMap.entrySet()) {
    String taskId=entry.getKey();
    List<MetricInfo> MetricList=entry.getValue();
    try {
      String component=clusterState.task_info(topologyId,Integer.valueOf(taskId)).getComponentId();
      TaskMetricInfo taskMetricInfo=new TaskMetricInfo(taskId,component);
      for (      MetricInfo metricInfo : MetricList) {
        taskMetricInfo.updateMetricData(metricInfo);
      }
      List<String> errors=taskMetricInfo.anyQueueFull();
      if (errors.size() > 0) {
        for (        String error : errors)         clusterState.report_task_error(topologyId,Integer.valueOf(taskId),error);
      }
      clusterState.update_task_metric(topologyId,taskId,taskMetricInfo);
    }
 catch (    Exception e) {
      logger.error(marker,"Failed to update metrics data in ZK for topo-{} task-{}.",topologyId,taskId,e);
    }
  }
}
