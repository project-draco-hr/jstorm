{
  Collection<PartitionConsumer> partitionConsumers=coordinator.getPartitionConsumers();
  for (  PartitionConsumer consumer : partitionConsumers) {
    EmitState state=consumer.emit(collector);
    LOG.debug("====== partition " + consumer.getPartition() + " emit message state is "+ state);
  }
  long now=System.currentTimeMillis();
  if ((now - lastUpdateMs) > config.offsetUpdateIntervalMs) {
    commitState();
  }
}
